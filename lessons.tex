\documentclass{article}

\usepackage{todonotes}
\usepackage[framed,numbered,autolinebreaks]{mcode}
\usepackage{fullpage}
\usepackage{url,textcomp}
\setlength{\parindent}{0pt}
\setlength{\parskip}{18pt}
\title{MATLAB Introduction}
\author{Rob Campbell \& Maxime Rio}
% //////////////////////////////////////////////////

\renewcommand{\familydefault}{\sfdefault}
\usepackage{helvet}
\usepackage[compact]{titlesec} 
\titlespacing\subsection{0pt}{12pt plus 4pt minus 2pt}{0pt plus 0pt minus 5pt}
\begin{document}

\maketitle


\section*{Introduction}

MATLAB is a fairly simple programming language designed to make analysis of data easy.
It is commonly used in academic research, industry, and finance.
It is used across scientific disciplines, from biologists to engineers.
During this course, you will use MATLAB to analyse existing 2-photon imaging data from mice, acquire new action potential data with electrodes, and analyse these data.
Today you will learn the basics of MATLAB.

MATLAB stores data in \textbf{variables} and these variables are manipulated by \textbf{functions}.
There are simple functions for performing tasks such as multiplication and division.
There are also more complex functions for doing things such as calculating averages, fitting lines, and doing statistical tests.
Today you will learn the basic functions in MATLAB as well as how to chain these together using \textbf{loops} and \textbf{logic statements} to automate sequences of operations.
This is the basis of programming.

As you proceed you will doubtless get stuck.
For help you should use the MATLAB documentation that is built-in, Google, and ask for assistance.


\section{Starting MATLAB}

\todo[inline]{Start MATLAB from the Windows start menu.}
\todo[inline]{Add section on navigating the command line window, opening an m-file, and the system path.}
\todo[inline]{Describe the ribbon.}


\section{Working at the command line}

We will begin by treating MATLAB as a graphical calculator.
We will start off at the \textbf{command line}, where you see the \verb|>>| symbol.
You type commands in the space after the \verb|>>| symbol.

Take a deep breath and type a number into the command line, e.g. \\
\verb|>>| \mcode{1} \\
then press return.\todo{enter?} \\
See how it echoes the number back to you? Now type: \\
\verb|>>| \mcode{1;} \\
Note the presence of the \mcode{;} symbol.
See how it no longer echoes the number back to you?
The \mcode{;} suppresses the echo.
You will use this feature a lot so keep it in mind.

\todo[inline]{positive/negative numbers, scientific notation}

Now let's look at basic arithmetic operators. \todo{floating point values? negative values?}
Type the following into the command line (note we leave off the semicolon so you can see the output):
\begin{lstlisting}
4 + 10
4 - 10
4 * 10
4 / 10
4^3
\end{lstlisting}
What does the last line \mcode{4^3} do?

Of course you can use several operators in the same line, but be careful with their priority.
You can force the order of the operations using parentheses.
Compare the results from the following lines:
\begin{lstlisting}
4 + 2 * 3 - 1
(4 + 2) * 3 - 1
(4 + 2) * (3 - 1)
\end{lstlisting}

To conclude this first part, enter the following into the command line: \\
\verb|>>| \mcode{\%This is a comment} \\
After pressing enter, nothing should have happened.
Indeed, any lines starting with the \mcode{\%} symbol are \verb|comments| and aren't executed by MATLAB.
We will use these comments to provide additional information to you.


\section{Manipulating simple variables}

A variable is a mechanism to keep track of a value with a name.
Variables are assigned with the \mcode{=} (equals) operator.
The name of a variable is on the left of \mcode{=} and the value on the right, e.g.\\
\verb|>> myvariable = 12|

Type the following into the command line.
Remember, you don't need to type the comments, those are just to explain what is going on.
\begin{lstlisting}
t = 1      % assign the number 1 to a variable called t
r = 10.5;  % create another variable (note lack of echoing)
a = r      % assigning one variable to another
a          % display the value of the variable
\end{lstlisting}

If you assign several times values to the same variable, values are replaced in turns.
\begin{lstlisting}
t = 2  % previous value replaced by 2
t = 3  % value 2 replaced by 3
\end{lstlisting}

You can use variables in place of values for arithmetic operations.
Type the following in the command line:
\begin{lstlisting}
t = 2;
T = t + 10  % addition
T = t - 10  % subtraction
T = t * 2   % multiplication
T = t / 10  % division
T = t^3     % raising to the third power
\end{lstlisting}

By the way, what is the final value of \mcode{T}? and \mcode{t}?
Be careful, variables names are case sensitive, so \mcode{T} and \mcode{t} are different variables!
\todo{talk about fine names for variables?}

If you want to know about the currently used variables, have a look to the \textbf{workspace} panel.
There you will see names and values of your variables.
So far, we have only been manipulating numbers, aka scalar values in MATLAB parlance.
We will see later more advanced types like arrays and strings (sequence of characters).

Sometimes, one may want to delete a variable, because it is not used anymore and use a lot of memory.
To do so, you will use the \mcode{clear} command.
Type the following in the command line and check how the \textbf{workspace} panel changes:
\begin{lstlisting}
clear    % remove all variables
a = 3    % new variable
b = 4    % new variable
clear a  % remove one variable
c = a    % assign a variable to another one and... surprise!
\end{lstlisting}
What happened at last line? Keep in mind that a variable need to exist in order to be used.


\section{Using MATLAB functions}

So far, you were limited to basic arithmetic.
What if you want to do more advanced math? or control a little bit the interface?
For these cases, MATLAB provides a huge number of functions to do all sort of operations.

To use a function, you need to type its name.
In the command line, try typing \mcode{clc} and see what happens.

If you want to now more about this function, you can use \mcode{help} command as follows: \\
\verb|>> help clc| \\
You can also use \mcode{doc} command to get an extended help, typing \mcode{doc clc}.

A function can have inputs and outputs.
Inputs are enclosed in parenthesis, after the function name, and separated by commas.
You get back the output(s) using variable assignment.

Give a try with the \mcode{cos} function (cosine of an angle), typing the following:
\begin{lstlisting}
clear         % remove all previously defined variables
cos(3.14)     % cosine of Pi
x = 3.14;     % create a new variable (no echoing)
cos(x)        % cosine of the value of x
y = cos(x);   % assign the result to a variable (no echoing)
\end{lstlisting}

What about a function that takes several inputs?
Have a look to \mcode{rem} function, using \mcode{help} or \mcode{doc} command.
Use this function to compute the remainder after division of 823 by 11.

Some function can have optional inputs.
A good example is the \mcode{round} function.
Check its documentation using \mcode{help} to understand the difference between the following lines:
\begin{lstlisting}
clear         % remove all variables
x = 4568.12;
r1 = round(x);
r2 = round(x, 0);
r3 = round(x, -2);
\end{lstlisting}
What are the values in variables \mcode{r1}, \mcode{r2} and \mcode{r3} at the end?

You've now learned the basics of entering information into the command-line.
\todo{multiple outputs functions, key/value interface using strings?}
\todo{add a example with mod}

\section{Writing your own functions}

A MATLAB \textbf{function} is just a text file that contains MATLAB code.
You will write them in the MATLAB editor and save them to disk.
After they've been saved, you will be able to use (or `run' or `call') the function from the command line in the same way as you did with the functions above.

Open a new file (`New' up at the top left of the GUI). \todo{add a figure?}
Save the file to the current directory and call it \verb|adder.m|.
The current directory is displayed up at the top. \todo{add figure?}
Type the following into your file in the editor and save it:
\begin{lstlisting}
function adder
  myVariable = 99;
  myOtherVariable = 101;
end
\end{lstlisting}
A function definition file always start with \mcode{function} keyword, and end with \mcode{end} keyword.
The function name, and possible inputs/outputs, are written after \mcode{function}.
Here there is no input nor output to this function.

According to you, what will happen when using this function?
Run the function by typing its name into the command line and check defined variables in the \textbf{workspace} panel. What do you see?

Notice how the variables defined in the \mcode{adder} function are not present in the \textbf{base workspace}, i.e. the variables available to you in the command line.
This fact is called \textbf{scope}.
The variables in your \mcode{adder} function exist only in the scope of the \mcode{adder} function.
They are created when \mcode{adder} runs and they are cleaned up when it ends.
This is a very important programming concept and you should keep it in mind.

Let's make \mcode{adder} \emph{do} something useful and return information to the command line.
We will define a \textbf{parameter} (input variable \mcode{varIN}) and have it multiply this by 2 then subtract 1.
Finally it will return the result to the workspace (output variable \mcode{OUT}).
Modify \mcode{adder} so that it reads as follows, then save it.
\begin{lstlisting}
function OUT = adder(varIN)
  % the adder function multiplies by 2 then subtracts 1
  doubledIN = varIN * 2;
  OUT = doubledIN - 1;
end
\end{lstlisting}

At the command line you will type, for example: \mcode{A = adder(34)}.
Check in the \textbf{workspace} panel the existing variables.
Is there any variable from the function (\mcode{varIN}, \mcode{doubledIN} or \mcode{OUT})?
It doesn't matter how many variables are temporarily created in our function, its final output is just one variable.

Notice the second line full of human readable words?
This line of comments is not used by MATLAB to compute the result but documents what is happening in the function.
When you start writing your own functions you should be using comments all the time to make your code easier to read at a later time.


\section{Manipulating multi-dimensional arrays}

So far we've mainly worked with single numbers, but MATLAB really shows its power when you start working with \textbf{vectors}, \textbf{matrices} and more general multi-dimensional \textbf{arrays}.

\subsection*{Vectors and indexing}

A vector is just a list (one row or one column) of numbers.
Let's learn how to create and manipulate these.
Type the following into the command line.
\begin{lstlisting}
[1,20,30,40,500,1000]      % make a vector
t = [1,20,30,40,500,1000]  % assign vector to a variable
\end{lstlisting}

MATLAB provides convenient ways to create \textbf{ranges}, i.e. vectors of evenly spaced numbers.
Try the following in the command line:
\begin{lstlisting}
clear                % remove all variables
t = 1:5              % shortcut for [1, 2, 3, 4, 5]
t = 1:2:10           % shortcut for [1, 3, 5, 7, 9]

start = 20;
step = 5;
stop = 100;
t = start:step:stop  % using variables instead of values
\end{lstlisting}
How would you create the vector \mcode{[5, 8, 11, 14]} using this syntax? What about \mcode{[-1, -2, -3, -4]}?

You will now learn how to \textbf{index} the vector.
Indexing is \textit{very important}.
Basically, ``indexing'' is the process of accessing sub-portions of the vector.
Go through the following at the command line.
If any of it does not make sense you should ask someone for help.
\begin{lstlisting}
t = [1, 10, 20,30, 40, 500, 1000]
t(1)        % access first element of vector
t([2, 3])   % access second and third elements
t(2:4)      % use a range to access several elements
idx = 2:4;
t(idx)      % use a variable (containing a range)
t(end)      % access to the last element
t(1:2:end)  % access elements at odd indices
\end{lstlisting}
\todo{logical indexing, linear indexing?}

To check the actual size of a vector, you can use \mcode{length}, \mcode{size} or \mcode{numel} functions.
Try all three functions on the \mcode{t} variable. What is the difference?
Have a look to the documentation of these functions.

The variable \mcode{t} is a row vector (1 row).
You can turn it into a column vector (1 column) by transposing it, using a single quote \mcode{'}.
Work through the following:
\begin{lstlisting}
size(t)    % size of the row vector
t2 = t';   % transposing using a quote
size(t2)   % size of the column vector
\end{lstlisting}


\subsection*{Matrices and other arrays}

A vector has one dimension, whereas an \textbf{matrix} has two dimensions.
An \textbf{array} is a more generic creature, with any number of dimensions, thus vectors and matrices are arrays.
During this course you will handle 2-photon imaging data which are represented as a 3-D arrays.
The first two dimensions for the rows and columns of pixels in the image and the third dimension is time.
You will also handle vector data, such as voltage traces from an electrical recording of neuronal activity.

In the following exercise you will learn how to make a matrix ``by hand'' and how to index it.
\begin{lstlisting}
t = [1,2,3,90; 4,5,6,90] % make an array with two rows and four columns
size(t)
\end{lstlisting}
Try \mcode{numel} and \mcode{length} functions on this matrix.
What's different from vector case?

Now you will learn how to index an array.
It is very similar to indexing vectors, except that there are several dimensions:
\begin{lstlisting}
t(1, 2)      % first line, second column
t(1, [2,3])  % first line, second and thirs columns
t(1, :)      % first line, all columns
t(:, 2)      % all lines, second column
\end{lstlisting}
The \mcode{:} (colon) operator is used to index a whole dimension.

\subsection*{Usual array operations}

Arithmetic still works with arrays and scalars, e.g. you can easily add, subtract, multiply, etc. all elements of an array by a scalar.
Try the following:
\begin{lstlisting}
t = [1,2,3; 4,5,6]  % 2 by 3 matrix
a = 10              % scalar variable
t*10                % element-wise multiplication (aka scalar expansion)
\end{lstlisting}

To create arrays of zeros or ones, you will use \mcode{zeros} and \mcode{ones} functions.
Check their documentation with \mcode{help} or \mcode{doc}, and make a 3-by-4 matrix of zeros and a vector of 5 ones.

You have now learned to create, index and do some computations with vectors and arrays.
\todo{min, max, mean, std, etc?}


\section{Making shiny graphs for your data}

\subsection*{Basic plotting of vector data}
You will now learn to plot vectors and arrays of random numbers. Line and point data are plotted to screen
with the \mcode{plot} command. Open the doc page for the \mcode{plot} command. Read the \textbf{Description} and
\textbf{Example} sections. You will need to understand this information to complete the following exercises

\begin{itemize}
\item Create a new function called \mcode{testPlot}. It should look like this to begin with, then you will fill it in:
\begin{lstlisting}
function testPlot
% exercise function
clf %clears the current figure

subplot(2,2,1) %make subplot axix in top left

subplot(2,2,2) %make subplot axis in top right

subplot(2,2,3) %make subplot axis in bottom left

subplot(2,2,4) %make subplot axis in bottom right

\end{lstlisting}

\item Run the above. You should get a figure window with four empty sub-plots. Do not proceed until you have this.

\item Within your function, add a line that makes a \textbf{vector} of 100 random numbers and stores this in a variable called R.
Don't forget the semicolon.
\item Add a line of code below the first \mcode{subplot} command to plot the variable R as a default line plot using the \mcode{plot} function.
\item Add a line of code below the second \mcode{subplot} command to plot the variable R as a red line.
\item Add a line of code below the third \mcode{subplot} command to plot the variable R as a thicker red line.
\item Add a line of code below the fourth \mcode{subplot} command to plot the variable R as \textbf{red circles} not linked by a line.
\item Use the \mcode{xlim} command (remember \mcode{help xlim}) to restrict the display of the fourth plot to only the first 50 numbers.
\item SAVE THE RESULTING PLOT (WE NEED TO DECIDE HOW THEY WILL DO THIS)
\item SHOULD WE TEACH \mcode{hold on} and \mcode{hold off}?
\end{itemize}

\subsection*{Basic plotting of array (image) data}
\textbf{Extend all this to images with \mcode{imagesc}.}


\section{Conditional execution with \emph{if\dots else} statement}

\verb|Conditional expressions| are really important since they allow you to add logic to a function or script. From now on we're going to be typing in more and more of our code into functions rather than into the command line. You should be typing the following examples into files and running the files in the manner shown previously. Let's start off with a very simple conditional expression involving an \mcode{if} statement.

\begin{lstlisting}
function myFunction
	if (1==1)
	  disp('This runs')
	end
\end{lstlisting}

Type the above into a function and run it. Now try:
\begin{lstlisting}
function myFunction
	if (1==2)
	  disp('This does not run')
	end
	disp('But this does run')
\end{lstlisting}

I think you can see what's going on. The \mcode{==} means `is equal to'\footnote{A very common syntax error that you \textit{will} make is to type \mcode{1=2} instead of \mcode{1==2}. Remember that \mcode{=} is the assignment operator but \mcode{==} is an equality test.
}. Try typing \mcode{1==1} and then \mcode{1==2} into the command line. What do you see? Those commands return a logical value: 0 or 1. Thus, the following is legal MATLAB code:
\begin{lstlisting}
function myFunction
	if (0)
	  disp('This does not run')
	end
	if (1)
	  disp('But this does run')
    end
\end{lstlisting}

In the previous example we have two if statements one after the other. There is a way that we can link them and produce more elegant code:
\begin{lstlisting}
function myFunction
    T=1;
	if (T)
	  disp('This will run')
	else
	  disp('But this does not run')
    end
\end{lstlisting}

You can even go one step further:

\begin{lstlisting}
function myFunction
    T=10;
	if (T==10)
	  disp('This will run')
	elseif (T<5)
	  disp('But this does not run')
    else
       %Something else
    end
\end{lstlisting}


%the find() command, switch statements


\section{Repeating operations with \emph{for} loop}

\mcode{for} loops are another loop type. They are used when the number of repetitions is known in advance. This is the syntax:
\begin{lstlisting}
%one example
for ii=1:10
 disp(ii)
end

%another example
for ii=1:10:100
 disp(ii)
end
\end{lstlisting}

You can nest for loops:
\begin{lstlisting}
for ii=1:20:100
  for jj=1:5
    fprintf('ii is %d and jj is %d\n',ii,jj)
  end
end
\end{lstlisting}

%In general, nested for loops aren't a great a idea. MATLAB works better with \verb|vectorised| code. i.e. Code that uses matrix operations.


\section{(Bonus) Manipulating text: string variables}

A string in MATLAB is a vector of characters. We can define a string easily enough:
\begin{lstlisting}
myStr='This is a string'; %just use single quotes to define a string
%Strings follow the same indexing rules as numeric vectors:
myStr(1:4) %returns "This" to the command line
\end{lstlisting}

Note that \mcode{S='1'} is the string `1' and \mcode{S=1} is the number `1'. Do you have any idea why \mcode{'1' * 10} doesn't return an error? Hint: the `1' is an ASCII character. You can convert a string to a number: \mcode{str2num('1')*10} That returns the expected answer. MATLAB has many such `xxx2yyy' commands for converting one thing to another.

As you might expect, MATLAB has a load of functions to deal with strings. Let's look at two of them now. \mcode{strcmp} is used to determine if two strings are identical and \mcode{strfind} looks for the occurances of one string in another string. Here are examples:

\begin{lstlisting}
A='a string';
B='some other string';
C='a string';
strcmp(A,B) %returns 0, indicating that this comparison is false
strcmp(A,C) %returns 1, indicating that this comparison is Turner

strfind(A,'string') %returns 3, why is that?
strfind(A,'String') %returns an empty array, why is that?
\end{lstlisting}


\section{(Bonus) The debugger might be your best friend}



\pagebreak


Type \mcode{rand} into the command line and press return. What happened?
Do it again a few more times. What happened?
What do you think the \mcode{rand} command does?
Type \mcode{help rand} to see the help text for the \mcode{rand} function.
Type \mcode{doc rand} to get this in GUI form.
Read the help text to understand how the inputs to function work.

Based on the help text, get the \mcode{rand} command to return a \textbf{matrix} of 5 rows and 5 columns of random numbers. Now get the \mcode{rand} command to return a matrix of 10 rows and 2 columns. Finally, return a single column of 10 numbers. This is called a column \textbf{vector}. You will notice that the MATLAB help often refers to a list of numbers as a vector, this is just common engineering terminology.




Complete the following tasks:
\begin{itemize}
\item Make an array of random numbers with 5 columns and 10 rows and assign it to a variable called \mcode{R}. i.e.
make an array of size 5 by 10. This is a 2D array.
\item Index R to return to the command line the value in column 3, row 8
\item Index R to return to the command line the 4th row
\item Index R to return to the command line the 7th column
\item Index R to return to the command line the first 5 values on the 2nd row
\item Make an array of random numbers  with 5 columns and 10 rows and assign it to a variable called \mcode{R}
\item Make an array of random numbers of size 5 by 5 by 3. This is a a 3D array. Use the \mcode{help} or \mcode{doc} commands
for help. The purpose of this question is to teach you how to read the help text.
\end{itemize}




\section*{Exercises}
\begin{enumerate}

\item Use \mcode{rand}, \mcode{round}, and \mcode{*} to produce a vector of 5000 random integers having values between 0 and 20.
Use the \mcode{unique} command to confirm that you have values from 0 to 20 and no others. Use the \mcode{hist} command to make a histogram of the distribution. Plot the histogram with 21 bins, since you have that many unique numbers. Does it look like a uniform distribution? Replace \mcode{round} with \mcode{ceil} and repeat. Is it uniform now?

\item Using the random vector you generated in the previous exercise, apply the \mcode{find} command and the \mcode{length} command to count the number of times the number 10 occurred. Does this number match what the histogram showed?

\item Repeat the previous exercise (ignoring the histogram) and count how many times a number less than or equal to two occurred. Repeat again and count the number of times a number less than or equal to three occurred. Now write a \mcode{for} loop that performs this count for all numbers between 1 and 20 (which are the unique numbers in the vector).

\item Build a structure containing three fields: a 1 by 30 random data vector, r, and two strings (x and y).  e.g.
\begin{lstlisting}
S.r=randn(1,30);
S.y='Y string';
S.x='X string';
\end{lstlisting}


make and array of 1 by 4 such structures. Use these to make 4 subplots. The vector is plotted. The two strings are the x and y labels for each plot. Use a loop.

\item You have already learned about \mcode{if} statements involving the \mcode{==} operator. Go to the MATLAB help and learn about these related operators: \mcode{<}, \mcode{>}, \mcode{!=}, \mcode{>=}, and \mcode{<=}. Make sure you are comfortable with using all of them. Modify the \mcode{if} examples above to try out these other logic operators.

\item Go to the MATLAB help and learn about the AND and OR operators (\mcode{&} and \mcode{\|}). Write a function with two input arguments (e.g. \mcode{myFunction(arg1,arg1)}) which will be single numbers. Use \mcode{if} statements along with the AND and OR operators to achieve the following: 1. Execute a block of code if either \mcode{arg1} or \mcode{arg2} is greater than 10.  2. Execute a block of code if both \mcode{arg1} and \mcode{arg2} are greater than 10.

\item Write a function with an \mcode{if}/\mcode{elseif}/\mcode{else} statement and one input argument. Use the \mcode{isnumeric} and \mcode{ischar} functions to conditionally execute different blocks of code depending on whether the input argument was a number, a string, or something else. What type of input would you need to have the function execute the final \mcode{else} statement? i.e. neither a numeric or string input would (or should) cause this final code block to execute.

\item Modify the random number while loop so it runs until the random number generator has produced two numbers over 0.8. Modify it again so it only breaks the loop if these two numbers are produced one after the other in succession.

\item Build a 9 by 10 array. Plot this in an array of 3 by 3 subplots. Each subplot contains data from one row of the matrix. (Hint: array indexing). Waveforms should be red lines with no symbols. Add a green circle at the maximum value of each plot. (Hint: help max)

\item Modify the previous exercise so that all sub-plots have the same scale.

\item Modify the previous exercise, using \mcode{if} to add the label `X' to the bottom row of subplots only.

\item Write a function that takes as arguments two strings. Have the function print `SAME!' to the command line code if both strings are the same. Once you've done that,  modify your function so that it prints `String A contains String B' if (you guessed it) string A contains string B. Hint: \mcode{isempty}

\end{enumerate}


\end{document}
